<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>防災情報マップ</title>
    <style>
        html, body, #map {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        .popup-content {
            font-size: 14px;
        }
    </style>
    <!-- LeafletのCSSを読み込み -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div id="map"></div>

    <!-- LeafletのJSを読み込み -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- 地理院タイル読み込み -->
    <script src="https://maps.gsi.go.jp/js/leaflet-gsi.js"></script>
    <script>
        // 地図の初期化
        var map = L.map('map', {
            center: [35.681236, 139.767125], // 東京駅の位置
            zoom: 13
        });

        // 地理院地図の標準タイルを追加
        var stdMap = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
            attribution: "<a href='https://maps.gsi.go.jp/development/ichiran.html'>地理院タイル</a>"
        }).addTo(map);

        // レイヤーの追加（淡色地図や写真など）
        var paleMap = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png');
        var photoMap = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg');

        // ハザードマップのレイヤー追加（例として浸水想定区域）
        var floodLayer = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/inundation/{z}/{x}/{y}.png', {
            opacity: 0.5
        });

        // レイヤーコントロールを追加
        var baseMaps = {
            "標準地図": stdMap,
            "淡色地図": paleMap,
            "写真": photoMap
        };

        var overlayMaps = {
            "浸水想定区域": floodLayer
            // 他のハザードレイヤーも追加可能
        };

        L.control.layers(baseMaps, overlayMaps).addTo(map);

        // 避難所のデータ（サンプル）
        var shelters = [
            {
                name: "中央区総合スポーツセンター",
                lat: 35.6825,
                lng: 139.7740,
                info: "収容人数: 800人<br>設備: 電源〇、Wi-Fi〇、トイレ◎<br>混雑度: 50%"
            },
            {
                name: "日本橋小学校",
                lat: 35.6861,
                lng: 139.7785,
                info: "収容人数: 500人<br>設備: 電源△、Wi-Fi×、トイレ〇<br>混雑度: 75%"
            }
            // 他の避難所も追加可能
        ];

        // アイコンの設定
        var shelterIcon = L.icon({
            iconUrl: 'https://maps.gsi.go.jp/image/legend/避難所.png', // 適切なアイコン画像URLを指定
            iconSize: [32, 37],
            iconAnchor: [16, 37],
            popupAnchor: [0, -37]
        });

        // ピンを地図上に追加
        shelters.forEach(function(shelter) {
            L.marker([shelter.lat, shelter.lng], {icon: shelterIcon})
                .addTo(map)
                .bindPopup("<div class='popup-content'><strong>" + shelter.name + "</strong><br>" + shelter.info + "</div>");
        });

        // ユーザーの位置情報を取得して表示
        map.locate({setView: true, maxZoom: 16});
        function onLocationFound(e) {
            L.marker(e.latlng).addTo(map)
                .bindPopup("現在地").openPopup();
        }
        map.on('locationfound', onLocationFound);

        function onLocationError(e) {
            alert("位置情報を取得できませんでした。");
        }
        map.on('locationerror', onLocationError);
    </script>
</body>
</html>
